version: 2
jobs:
  build:  
    machine: true
    steps:
      - checkout          
         
      # build the application image
      - run: docker build -t $DOCKER_REGISTRY_NAME/climatemindbackend:$CIRCLE_BUILD_NUM .

  push: 
    # push the image to the registry
    machine: true
      steps:
        # log into Docker registry
        - run: echo "$DOCKER_PASS" | docker login $DOCKER_REGISTRY_NAME --username $DOCKER_USER --password-stdin
        - run: docker push $DOCKER_REGISTRY_NAME/climatemindbackend:$CIRCLE_BUILD_NUM
workflows:
  version: 2
  build_and_push:
    jobs:
      - build      
      - push:
          requires:
            - build      
